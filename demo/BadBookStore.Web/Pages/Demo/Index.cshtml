@page
@model BadBookStore.Web.Pages.Demo.IndexModel
@{
    ViewData["Title"] = Model.Title;
}

<h2>@Model.Title</h2>

<div style="margin:.25rem 0 1rem 0;">
    @if (Model.FixesApplied)
    {
        <span style="
          display:inline-block;padding:.25rem .5rem;border-radius:.5rem;
          background:#e6ffed;border:1px solid #2ecc71;color:#1f7a3a;
          font-size:.85rem;font-weight:600;">
            Fixes: Applied
        </span>
    }
    else
    {
        <span style="
          display:inline-block;padding:.25rem .5rem;border-radius:.5rem;
          background:#fff5f5;border:1px solid #ff6b6b;color:#8a1c1c;
          font-size:.85rem;font-weight:600;">
            Fixes: Not Applied
        </span>
    }
</div>

<p><strong>Elapsed:</strong> @Model.ElapsedMs ms</p>
<p><strong>Row Count:</strong> @Model.Count</p>

@if (!string.IsNullOrWhiteSpace(Model.SqlShape))
{
    <details>
        <summary>Query shape (for discussion)</summary>
        <pre>@Model.SqlShape</pre>
    </details>
}

@if (Model.Sample is not null)
{
    <h3>Sample</h3>
    <pre>@System.Text.Json.JsonSerializer.Serialize(Model.Sample, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })</pre>
}

<div class="explain-row" style="margin:.75rem 0 1rem 0;">
    <button type="button"
            class="btn-explain"
            hx-get='@Url.Page("Index", "Explain", new { q = Model.q })'
            hx-target="#explainPanel"
            hx-swap="innerHTML">
        Explain this query
    </button>

    <button type="button"
            class="btn-clear"
            hx-get='@Url.Page("Index", "Explain", new { q = 0 })'
            hx-target="#explainPanel"
            hx-swap="innerHTML"
            style="margin-left:.5rem">
        Clear explanation
    </button>
</div>

<div id="explainPanel" class="explain-panel">
    <!-- htmx will inject the explanation html here -->
</div>

<p style="margin-top:1rem"><a asp-page="/Index">Back</a></p>

<style>
  .btn-explain, .btn-clear {
    padding:.35rem .6rem; border:1px solid #bbb; border-radius:.4rem; background:#fafafa; cursor:pointer;
  }
  .btn-explain:hover, .btn-clear:hover { background:#f0f0f0; }
  .explain-panel {
    border:1px solid #e5e5e5; border-radius:.5rem; padding:1rem; background:#fff; display:block;
  }
  .explain-panel h3 { margin:.25rem 0 .5rem 0; }
  .badge { display:inline-block;padding:.15rem .4rem;border-radius:.35rem;font-size:.8rem;border:1px solid #ccc;background:#f7f7f7;margin-right:.25rem;}
  code { background:#f6f8fa; padding:.1rem .3rem; border-radius:.25rem; }
</style>